#+begin_src clojure :results pp
(ns user
  (:require [feedcircuit-revisited.main :as m]
            [feedcircuit-revisited.feed :as f]
            [feedcircuit-revisited.backend :as b]
            [feedcircuit-revisited.schema :as schema]
            [feedcircuit-revisited.datomic-backend :as d-b]
            [feedcircuit-revisited.fs-backend :as f-b]
            [feedcircuit-revisited.content :as c]
            [feedcircuit-revisited.ui :as u]
            [feedcircuit-revisited.handler :as h]
            [feedcircuit-revisited.conf :as conf]
            [feedcircuit-revisited.schema :as s]
            [datomic.client.api :as d]
            [hiccup.core :as html]
            [clojure.zip :as zip]
            [me.raynes.fs :as fs]
            [clojure.xml :as xml]
))
#+end_src

#+RESULTS:
: 
: 

#+begin_src clojure :results pp
(d/q '[:find (pull ?f [
                       :feed/url
                       ;:feed/title
                       ;:feed/last-num
                       ;*
                       ])
       :where [?f :feed/url _]]
     (d/db d-b/conn))
#+end_src

#+RESULTS:
#+begin_example
[[#:feed{:url "http://www.opennet.ru/opennews/opennews_all.rss"}]
 [#:feed{:url "https://www.kommersant.ru/RSS/section-hitech.xml"}]
 [#:feed{:url "https://xkcd.com/atom.xml"}]
 [#:feed{:url "https://www.zerohedge.com/fullrss2.xml"}]
 [#:feed{:url "https://news.ycombinator.com/rss"}]
 [#:feed{:url "http://feeds.arstechnica.com/arstechnica/index/"}]
 [#:feed{:url "https://content.novayagazeta.ru/rss/all.xml"}]
 [#:feed{:url "https://news.mail.ru/rss/90/"}]
 [#:feed{:url "http://static.feed.rbc.ru/rbc/logical/footer/news.rss"}]
 [#:feed{:url "https://www.exler.ru/rss.xml"}]
 [#:feed{:url "http://blog.cleancoder.com/atom.xml"}]
 [#:feed{:url "https://exler.ru/films/rss.xml"}]
 [#:feed{:url "https://www.archlinux.org/feeds/packages/"}]
 [#:feed{:url
         "http://comicfeeds.chrisbenard.net/view/dilbert/default"}]
 [#:feed{:url "https://lenta.ru/rss"}]
 [#:feed{:url "http://feeds.feedburner.com/PythonInsider"}]
 [#:feed{:url "https://clojure.org/feed.xml"}]
 [#:feed{:url "https://www.archlinux.org/feeds/news/"}]
 [#:feed{:url "http://rss.slashdot.org/Slashdot/slashdotMain"}]
 [#:feed{:url "https://kiwibyrd.org/feed/"}]
 [#:feed{:url "http://4pda.ru/feed/"}]
 [#:feed{:url "https://www.anandtech.com/rss/"}]
 [#:feed{:url "https://bikepost.ru/rss/index/"}]
 [#:feed{:url "http://sgolub.ru/feed/"}]
 [#:feed{:url "https://www.kommersant.ru/RSS/section-politics.xml"}]
 [#:feed{:url "https://www.kommersant.ru/RSS/Autopilot_on.xml"}]
 [#:feed{:url "https://www.computerra.ru/feed/"}]
 [#:feed{:url "https://www.kommersant.ru/RSS/section-world.xml"}]
 [#:feed{:url "https://habr.com/ru/rss/best/daily/"}]
 [#:feed{:url "http://feeds.feedburner.com/zerohedge/feed"}]
 [#:feed{:url "http://4pda.to/feed/"}]]

#+end_example

#+begin_src clojure :results pp
(b/get-user-data "georgy@kibardin.name"
                   :sources/feed-title
)
#+end_src

#+RESULTS:
#+begin_example
#:user{:id "georgy@kibardin.name",
       :sources
       ({:source/feed "https://news.mail.ru/rss/90/",
         :source/filters ,
         :source/position 250,
         :source/num 0,
         :feed/title "Новости Mail.ru",
         :feed/url "https://news.mail.ru/rss/90/",
         :source/seen true,
         :source/active true,
         :source/id "https://news.mail.ru/rss/90/"}
        {:source/feed "https://lenta.ru/rss",
         :source/filters ,
         :source/position 4691,
         :source/num 1,
         :feed/title "Lenta.ru : Новости",
         :feed/url "https://lenta.ru/rss",
         :source/seen false,
         :source/active true,
         :source/id "https://lenta.ru/rss"}
        {:source/feed "http://feeds.feedburner.com/zerohedge/feed",
         :source/filters ,
         :source/position 2267,
         :source/num 2,
         :feed/title "ZeroHedge News",
         :feed/url "http://feeds.feedburner.com/zerohedge/feed",
         :source/seen false,
         :source/active true,
         :source/id "http://feeds.feedburner.com/zerohedge/feed"}
        {:source/feed "https://news.ycombinator.com/rss",
         :source/filters ,
         :source/position 4178,
         :source/num 3,
         :feed/title "Hacker News",
         :feed/url "https://news.ycombinator.com/rss",
         :source/seen false,
         :source/active true,
         :source/id "https://news.ycombinator.com/rss"}
        {:source/feed "http://rss.slashdot.org/Slashdot/slashdotMain",
         :source/filters ,
         :source/position 807,
         :source/num 4,
         :feed/title "Slashdot",
         :feed/url "http://rss.slashdot.org/Slashdot/slashdotMain",
         :source/seen false,
         :source/active true,
         :source/id "http://rss.slashdot.org/Slashdot/slashdotMain"}
        {:source/feed "https://xkcd.com/atom.xml",
         :source/filters ,
         :source/position 198,
         :source/num 5,
         :feed/title "xkcd.com",
         :feed/url "https://xkcd.com/atom.xml",
         :source/seen false,
         :source/active true,
         :source/id "https://xkcd.com/atom.xml"}
        {:source/feed
         "http://comicfeeds.chrisbenard.net/view/dilbert/default",
         :source/filters ,
         :source/position 399,
         :source/num 6,
         :feed/title "Dilbert Daily Strip",
         :feed/url
         "http://comicfeeds.chrisbenard.net/view/dilbert/default",
         :source/seen false,
         :source/active true,
         :source/id
         "http://comicfeeds.chrisbenard.net/view/dilbert/default"}
        {:source/feed "https://exler.ru/films/rss.xml",
         :source/filters ,
         :source/position 217,
         :source/num 7,
         :feed/title "Exler.ru",
         :feed/url "https://exler.ru/films/rss.xml",
         :source/seen false,
         :source/active true,
         :source/id "https://exler.ru/films/rss.xml"}
        {:source/feed "https://kiwibyrd.org/feed/",
         :source/filters ,
         :source/position 47,
         :source/num 8,
         :feed/title "kiwi  arXiv",
         :feed/url "https://kiwibyrd.org/feed/",
         :source/seen true,
         :source/active true,
         :source/id "https://kiwibyrd.org/feed/"}
        {:source/feed "http://sgolub.ru/feed/",
         :source/filters ,
         :source/position 47,
         :source/num 9,
         :feed/title "АВТОРСКИЙ ПРОЕКТ СЕРГЕЯ ГОЛУБИЦКОГО",
         :feed/url "http://sgolub.ru/feed/",
         :source/seen true,
         :source/active true,
         :source/id "http://sgolub.ru/feed/"}
        {:source/feed "https://bikepost.ru/rss/index/",
         :source/filters ,
         :source/position 2115,
         :source/num 10,
         :feed/title "БайкПост",
         :feed/url "https://bikepost.ru/rss/index/",
         :source/seen false,
         :source/active true,
         :source/id "https://bikepost.ru/rss/index/"}
        {:source/feed
         "http://www.opennet.ru/opennews/opennews_all.rss",
         :source/filters ,
         :source/position 286,
         :source/num 11,
         :feed/title "OpenNews.opennet.ru: Общая лента новостей",
         :feed/url "http://www.opennet.ru/opennews/opennews_all.rss",
         :source/seen false,
         :source/active true,
         :source/id "http://www.opennet.ru/opennews/opennews_all.rss"}
        {:source/feed "https://habr.com/ru/rss/best/daily/",
         :source/filters ,
         :source/position 766,
         :source/num 12,
         :feed/title "Лучшие публикации за сутки",
         :feed/url "https://habr.com/ru/rss/best/daily/",
         :source/seen false,
         :source/active true,
         :source/id "https://habr.com/ru/rss/best/daily/"}
        {:source/feed "http://4pda.to/feed/",
         :source/filters ,
         :source/position 199,
         :source/num 13,
         :feed/title "4PDA",
         :feed/url "http://4pda.to/feed/",
         :source/seen false,
         :source/active true,
         :source/id "http://4pda.to/feed/"}
        {:source/feed "https://www.computerra.ru/feed/",
         :source/filters ,
         :source/position 886,
         :source/num 14,
         :feed/title "Компьютерра",
         :feed/url "https://www.computerra.ru/feed/",
         :source/seen false,
         :source/active true,
         :source/id "https://www.computerra.ru/feed/"}
        {:source/feed
         "https://www.kommersant.ru/RSS/section-hitech.xml",
         :source/filters ,
         :source/position 103,
         :source/num 15,
         :feed/title "\"Коммерсантъ Hi-Tech\"",
         :feed/url "https://www.kommersant.ru/RSS/section-hitech.xml",
         :source/seen false,
         :source/active true,
         :source/id "https://www.kommersant.ru/RSS/section-hitech.xml"}
        {:source/feed "https://www.kommersant.ru/RSS/Autopilot_on.xml",
         :source/filters ,
         :source/position 184,
         :source/num 16,
         :feed/title "Коммерсантъ Автопилот. Online и Новости",
         :feed/url "https://www.kommersant.ru/RSS/Autopilot_on.xml",
         :source/seen false,
         :source/active true,
         :source/id "https://www.kommersant.ru/RSS/Autopilot_on.xml"}
        {:source/feed "https://content.novayagazeta.ru/rss/all.xml",
         :source/filters "!Новости",
         :source/position 921,
         :source/num 17,
         :feed/title "Новая Газета",
         :feed/url "https://content.novayagazeta.ru/rss/all.xml",
         :source/seen false,
         :source/active true,
         :source/id "https://content.novayagazeta.ru/rss/all.xml"}
        {:source/feed
         "https://www.kommersant.ru/RSS/section-world.xml",
         :source/filters ,
         :source/position 4088,
         :source/num 18,
         :feed/title "\"Коммерсантъ\". В мире",
         :feed/url "https://www.kommersant.ru/RSS/section-world.xml",
         :source/seen false,
         :source/active false,
         :source/id "https://www.kommersant.ru/RSS/section-world.xml"}
        {:source/feed
         "https://www.kommersant.ru/RSS/section-politics.xml",
         :source/filters ,
         :source/position 147,
         :source/num 19,
         :feed/title "\"Коммерсантъ\". Политика",
         :feed/url
         "https://www.kommersant.ru/RSS/section-politics.xml",
         :source/seen false,
         :source/active true,
         :source/id
         "https://www.kommersant.ru/RSS/section-politics.xml"}
        {:source/feed "http://blog.cleancoder.com/atom.xml",
         :source/filters ,
         :source/position 32,
         :source/num 20,
         :feed/title "The Clean Code Blog",
         :feed/url "http://blog.cleancoder.com/atom.xml",
         :source/seen false,
         :source/active true,
         :source/id "http://blog.cleancoder.com/atom.xml"}
        {:source/feed "https://www.archlinux.org/feeds/packages/",
         :source/filters ,
         :source/position 50,
         :source/num 21,
         :feed/title "Arch Linux: Recent package updates",
         :feed/url "https://www.archlinux.org/feeds/packages/",
         :source/seen false,
         :source/active false,
         :source/id "https://www.archlinux.org/feeds/packages/"}
        {:source/feed "https://www.archlinux.org/feeds/news/",
         :source/filters ,
         :source/position 34,
         :source/num 22,
         :feed/title "Arch Linux: Recent news updates",
         :feed/url "https://www.archlinux.org/feeds/news/",
         :source/seen false,
         :source/active true,
         :source/id "https://www.archlinux.org/feeds/news/"}
        {:source/feed "https://clojure.org/feed.xml",
         :source/filters ,
         :source/position 26,
         :source/num 23,
         :feed/title "Clojure News",
         :feed/url "https://clojure.org/feed.xml",
         :source/seen false,
         :source/active true,
         :source/id "https://clojure.org/feed.xml"}
        {:source/feed "https://www.anandtech.com/rss/",
         :source/filters ,
         :source/position 563,
         :source/num 24,
         :feed/title "AnandTech",
         :feed/url "https://www.anandtech.com/rss/",
         :source/seen false,
         :source/active true,
         :source/id "https://www.anandtech.com/rss/"}
        {:source/feed
         "http://feeds.arstechnica.com/arstechnica/index/",
         :source/filters ,
         :source/position 710,
         :source/num 25,
         :feed/title "Ars Technica",
         :feed/url "http://feeds.arstechnica.com/arstechnica/index/",
         :source/seen false,
         :source/active true,
         :source/id "http://feeds.arstechnica.com/arstechnica/index/"}
        {:source/feed "http://feeds.feedburner.com/PythonInsider",
         :source/filters ,
         :source/position 25,
         :source/num 26,
         :feed/title "Python Insider",
         :feed/url "http://feeds.feedburner.com/PythonInsider",
         :source/seen false,
         :source/active true,
         :source/id "http://feeds.feedburner.com/PythonInsider"}),
       :selected
       (#:item{:id "577,https://habr.com/ru/rss/best/daily/"}
        #:item{:id "2022,https://lenta.ru/rss"}
        #:item{:id "1081,https://lenta.ru/rss"}
        #:item{:id "4035,https://news.ycombinator.com/rss"}
        #:item{:id "4044,https://news.ycombinator.com/rss"}
        #:item{:id "203,https://exler.ru/films/rss.xml"}
        #:item{:id "2020,http://feeds.feedburner.com/zerohedge/feed"}
        #:item{:id
               "https://www.exler.ru/ezhe/kardona-zloveshie-tajny-drevnego-zamka-i-solyanaya-peshera.htm"}
        #:item{:id "2024,http://feeds.feedburner.com/zerohedge/feed"}
        #:item{:id "1974,http://feeds.feedburner.com/zerohedge/feed"}
        #:item{:id "1748,http://feeds.feedburner.com/zerohedge/feed"}
        #:item{:id "1236,https://news.ycombinator.com/rss"}
        #:item{:id "1218,https://news.ycombinator.com/rss"}
        #:item{:id "1206,https://news.ycombinator.com/rss"}
        #:item{:id "898,http://feeds.feedburner.com/zerohedge/feed"}
        #:item{:id "887,http://feeds.feedburner.com/zerohedge/feed"}
        #:item{:id "270,https://habr.com/ru/rss/best/daily/"}
        #:item{:id "228,https://habr.com/ru/rss/best/daily/"}
        #:item{:id "1544,https://bikepost.ru/rss/index/"}),
       :styles
       (["arstechnica.com"
         "https://shashurup.github.io/feedcircuit-styles/arstechnica.css"]
        ["habr.com"
         "https://shashurup.github.io/feedcircuit-styles/img-data-src.js"])}

#+end_example
