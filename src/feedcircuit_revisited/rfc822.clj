(ns feedcircuit-revisited.rfc822
  (:require [java-time :as jt]
            [clojure.string :as s]))

(def timezones {
  "ACDT" "+1030"
  "ACST" "+0930"
  "ACT" "-0500"
  "ACWST" "+0845"
  "ADT" "-0300"
  "AEDT" "+1100"
  "AEST" "+1000"
  "AFT" "+0430"
  "AKDT" "-0800"
  "AKST" "-0900"
  "ALMT" "+0600"
  "AMST" "-0300"
  "AMT" "+0400"
  "ANAT" "+1200"
  "AQTT" "+0500"
  "ART" "-0300"
  "AST" "-0400"
  "AWST" "+0800"
  "AZOST" "+0000"
  "AZOT" "-0100"
  "AZT" "+0400"
  "BDT" "+0800"
  "BIOT" "+0600"
  "BIT" "-1200"
  "BOT" "-0400"
  "BRST" "-0200"
  "BRT" "-0300"
  "BST" "+0100"
  "BTT" "+0600"
  "CAT" "+0200"
  "CCT" "+0630"
  "CDT" "-0500"
  "CEST" "+0200"
  "CET" "+0100"
  "CHADT" "+1345"
  "CHAST" "+1245"
  "CHOT" "+0800"
  "CHOST" "+0900"
  "CHST" "+1000"
  "CHUT" "+1000"
  "CIST" "-0800"
  "CIT" "+0800"
  "CKT" "-1000"
  "CLST" "-0300"
  "CLT" "-0400"
  "COST" "-0400"
  "COT" "-0500"
  "CST" "-0600"
  "CT" "+0800"
  "CVT" "-0100"
  "CWST" "+0845"
  "CXT" "+0700"
  "DAVT" "+0700"
  "DDUT" "+1000"
  "DFT" "+0100"
  "EASST" "-0500"
  "EAST" "-0600"
  "EAT" "+0300"
  "ECT" "-0400"
  "EDT" "-0400"
  "EEST" "+0300"
  "EET" "+0200"
  "EGST" "+0000"
  "EGT" "-0100"
  "EIT" "+0900"
  "EST" "-0500"
  "FET" "+0300"
  "FJT" "+1200"
  "FKST" "-0300"
  "FKT" "-0400"
  "FNT" "-0200"
  "GALT" "-0600"
  "GAMT" "-0900"
  "GET" "+0400"
  "GFT" "-0300"
  "GILT" "+1200"
  "GIT" "-0900"
  "GST" "+0400"
  "GYT" "-0400"
  "HDT" "-0900"
  "HAEC" "+0200"
  "HST" "-1000"
  "HKT" "+0800"
  "HMT" "+0500"
  "HOVST" "+0800"
  "HOVT" "+0700"
  "ICT" "+0700"
  "IDLW" "-1200"
  "IDT" "+0300"
  "IOT" "+0300"
  "IRDT" "+0430"
  "IRKT" "+0800"
  "IRST" "+0330"
  "IST" "+0100"
  "JST" "+0900"
  "KALT" "+0200"
  "KGT" "+0600"
  "KOST" "+1100"
  "KRAT" "+0700"
  "KST" "+0900"
  "LHST" "+1100"
  "LINT" "+1400"
  "MAGT" "+1200"
  "MART" "-0930"
  "MAWT" "+0500"
  "MDT" "-0600"
  "MET" "+0100"
  "MEST" "+0200"
  "MHT" "+1200"
  "MIST" "+1100"
  "MIT" "-0930"
  "MMT" "+0630"
  "MSK" "+0300"
  "MST" "-0700"
  "MUT" "+0400"
  "MVT" "+0500"
  "MYT" "+0800"
  "NCT" "+1100"
  "NDT" "-0230"
  "NFT" "+1100"
  "NOVT" "+0700"
  "NPT" "+0545"
  "NST" "-0330"
  "NT" "-0330"
  "NUT" "-1100"
  "NZDT" "+1300"
  "NZST" "+1200"
  "OMST" "+0600"
  "ORAT" "+0500"
  "PDT" "-0700"
  "PET" "-0500"
  "PETT" "+1200"
  "PGT" "+1000"
  "PHOT" "+1300"
  "PHT" "+0800"
  "PKT" "+0500"
  "PMDT" "-0200"
  "PMST" "-0300"
  "PONT" "+1100"
  "PST" "-0800"
  "PYST" "-0300"
  "PYT" "-0400"
  "RET" "+0400"
  "ROTT" "-0300"
  "SAKT" "+1100"
  "SAMT" "+0400"
  "SAST" "+0200"
  "SBT" "+1100"
  "SCT" "+0400"
  "SDT" "-1000"
  "SGT" "+0800"
  "SLST" "+0530"
  "SRET" "+1100"
  "SRT" "-0300"
  "SST" "+0800"
  "SYOT" "+0300"
  "TAHT" "-1000"
  "THA" "+0700"
  "TFT" "+0500"
  "TJT" "+0500"
  "TKT" "+1300"
  "TLT" "+0900"
  "TMT" "+0500"
  "TRT" "+0300"
  "TOT" "+1300"
  "TVT" "+1200"
  "ULAST" "+0900"
  "ULAT" "+0800"
  "UYST" "-0200"
  "UYT" "-0300"
  "UZT" "+0500"
  "VET" "-0400"
  "VLAT" "+1000"
  "VOLT" "+0400"
  "VOST" "+0600"
  "VUT" "+1100"
  "WAKT" "+1200"
  "WAST" "+0200"
  "WAT" "+0100"
  "WEST" "+0100"
  "WET" "+0000"
  "WIT" "+0700"
  "WST" "+0800"
  "YAKT" "+0900"
  "YEKT" "+0500"

  "UTC" "+0000"
})

(def tz-pattern #"[A-Z][A-Z][A-Z]?[A-Z]?[A-Z]?")

(defn jt-parse-datetime [subj]
  (str (jt/instant (jt/formatter :rfc-1123-date-time) subj)))

(defn parse-datetime [subj]
  (if-let [tz (timezones (re-find tz-pattern subj))]
    (jt-parse-datetime (s/replace subj tz-pattern tz))
    (jt-parse-datetime subj)))
